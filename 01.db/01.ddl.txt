
/**
 * 돈믈리에 수강 신청
 *  - es_member 테이블에서 cellPhone 비교 후 번호 존재시 멤버 정보 update
 *  - 로그인 후에 수강신청시 로그인 정보로 내용 추가
 */
CREATE TABLE donmm_registration (
    seq BIGINT NOT NULL AUTO_INCREMENT comment 'pk', 
    phone VARCHAR(16) NOT NULL comment '전화번호 01011112222 형식',
    name VARCHAR(32) NOT NULL comment '이름',
    memNo int(10) NULL comment '계정 번호', 
    memId varchar(50) NULL comment '계정 id', 
	created_at DATETIME NOT NULL DEFAULT now() comment '등록 날짜',
	PRIMARY KEY (seq, phone)
) COLLATE='utf8mb4_unicode_ci' ENGINE=InnoDB;

CREATE INDEX donmm_registration_idx_01 ON donmm_registration ( phone );
CREATE INDEX donmm_registration_idx_02 ON donmm_registration ( memId );


/**
 * 돈믈리에 강의
 */
CREATE TABLE donmm_lecture (
    seq BIGINT NOT NULL AUTO_INCREMENT comment 'pk', 
    memNo int(10) NOT NULL comment '로그인 계정 번호', 
    memId varchar(50) NOT NULL comment '로그인 계정 id', 
    season int NOT NULL comment '시즌', 
    num TINYINT NOT NULL comment '수강한 강의 번호', 
    created_at DATETIME NOT NULL DEFAULT now() comment '수강 완료 날짜',
    PRIMARY KEY (`seq`, `memNo`, `memId` )
) COLLATE='utf8mb4_unicode_ci' ENGINE=InnoDB;

/**
 * 돈믈리에 시험
 */
CREATE TABLE donmm_exam (
    seq BIGINT NOT NULL AUTO_INCREMENT comment 'pk', 
    memNo int(10) NOT NULL comment '로그인 계정 번호', 
    memId varchar(50) NOT NULL comment '로그인 계정 id', 
    season int NOT NULL comment '시즌', 
    num TINYINT NOT NULL comment '시험 번호', 
    type varchar(8) NOT NULL comment '시험 유형', 
    score int NULL comment '시험 점수', 
    created_at DATETIME NOT NULL DEFAULT now() comment '시험 날짜',
    PRIMARY KEY (`seq`, `memNo`, `memId` )
) COLLATE='utf8mb4_unicode_ci' ENGINE=InnoDB;

/**
 * 돈믈리에 멤버
 */
CREATE TABLE donmm_members (
	seq BIGINT NOT NULL AUTO_INCREMENT,
    user_id VARCHAR(32) NOT NULL,    
	name VARCHAR(32) NULL DEFAULT NULL,
	password VARCHAR(128) NOT NULL,
	member_type CHAR(1) NOT NULL DEFAULT 'B',
	created_at DATETIME NOT NULL DEFAULT now(),
	updated_at DATETIME NOT NULL DEFAULT now(),
	deleted_at DATETIME NULL DEFAULT NULL,
	PRIMARY KEY (seq, user_id),
	UNIQUE INDEX user_id (user_id)
) COLLATE='utf8mb4_unicode_ci' ENGINE=InnoDB;

INSERT INTO donmm_members (user_id, name, password, member_type)
VALUES ('admin', '관리자', '$2y$10$xWS5oYGmDHnVju5qWFJX.evgGxzmjQJoycBtG.ISbPHlOBjFJWBsO', 'A');

